<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SportPulse Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/chart.js" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script type="module" src="js/dashboard.js"></script>
    <style>
        :root {
            --primary: #23235b;
            --secondary: #4C6FFF;
            --accent: #8A5CFF;
            --bg: linear-gradient(135deg, #181A3D 0%, #23235b 100%);
            --card-bg: rgba(30, 34, 70, 0.55);
            --sidebar-bg: rgba(24, 26, 61, 0.85);
            --text-main: #fff;
            --text-muted: #a0a3c4;
            --glass-blur: blur(18px);
        }
        body {
            background: var(--bg);
            color: var(--text-main);
        }
        .sidebar {
            background: var(--sidebar-bg);
            border-right: 1px solid #23235b;
            backdrop-filter: var(--glass-blur);
        }
        .dashboard-card {
            background: var(--card-bg);
            border-radius: 1.25rem;
            box-shadow: 0 4px 24px 0 rgba(44, 62, 80, 0.15);
            backdrop-filter: var(--glass-blur);
            border: 1px solid rgba(255,255,255,0.08);
            transition: box-shadow 0.2s, border 0.2s;
        }
        .dashboard-card:hover {
            box-shadow: 0 8px 32px 0 rgba(44, 62, 80, 0.22);
            border: 1.5px solid var(--secondary);
        }
        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            color: var(--text-muted);
            font-weight: 500;
            transition: background 0.15s, color 0.15s;
        }
        .sidebar-link.active, .sidebar-link:hover {
            background: var(--secondary);
            color: #fff;
        }
        .sidebar-link svg {
            width: 1.25rem;
            height: 1.25rem;
        }
        .sidebar-icon {
            width: 2.5rem;
            height: 2.5rem;
            background: var(--secondary);
            color: #fff;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.25rem;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
        }

        .metric-ring {
            position: relative;
            width: 160px;
            height: 160px;
        }

        .focus-timer {
            font-family: 'JetBrains Mono', monospace;
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1;
        }

        /* Premium Animations and Effects */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }

        .premium-insight {
            animation: float 6s ease-in-out infinite;
            background: linear-gradient(135deg, rgba(76,111,255,0.1), rgba(138,92,255,0.1));
            backdrop-filter: blur(8px);
            border: 1px solid rgba(76,111,255,0.2);
        }

        .productivity-ring {
            position: relative;
        }

        .productivity-ring::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 50%;
            padding: 2px;
            background: linear-gradient(45deg, var(--secondary), var(--accent));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: pulse 2s infinite;
        }

        .premium-card {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(76,111,255,0.1), rgba(138,92,255,0.1));
            border: 1px solid rgba(76,111,255,0.2);
        }

        .premium-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            transition: 0.5s;
        }

        .premium-card:hover::before {
            left: 100%;
        }

        .stats-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .mood-journal-section {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mood-post {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .mood-post:hover {
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .reaction-button {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border-radius: 2rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .reaction-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .reaction-button.active {
            background: var(--accent);
            color: white;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="particles"></div>
  <!-- Sidebar -->
  <aside class="sidebar w-20 md:w-60 h-screen fixed left-0 top-0 flex flex-col items-center py-6 z-10">
    <div class="sidebar-icon mb-8"><img src="assets/images/logo.svg" alt="SportPulse" class="w-8 h-8"></div>
    <nav class="flex flex-col gap-2 w-full items-center md:items-stretch">
      <a href="dashboard.html" class="sidebar-link active">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
          <span class="hidden md:inline">Home</span>
      </a>
      <a href="pages/cricket.html" class="sidebar-link">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
          <span class="hidden md:inline">Cricket</span>
      </a>
      <a href="pages/football.html" class="sidebar-link">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
          <span class="hidden md:inline">Football</span>
      </a>
      <a href="pages/basketball.html" class="sidebar-link">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          <span class="hidden md:inline">Basketball</span>
      </a>
      <a href="pages/news.html" class="sidebar-link">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2.5 2.5 0 00-2.5-2.5H15"/></svg>
          <span class="hidden md:inline">News</span>
      </a>
      <a href="pages/profile.html" class="sidebar-link">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
          <span class="hidden md:inline">Profile & Stats</span>
      </a>
      <!-- Settings link removed per request -->
    </nav>
    <div class="mt-auto mb-4 flex flex-col items-center w-full">
      <div id="userAvatar" class="w-10 h-10 rounded-full bg-gradient-to-br from-[var(--secondary)] to-[var(--accent)] flex items-center justify-center text-lg font-bold text-white mb-2 overflow-hidden">
        <!-- Avatar image or initials will be injected here -->
      </div>
      <div class="text-xs text-center text-[var(--text-secondary)]" id="userNameSidebar">User</div>
    </div>
  </aside>
  <!-- Main Content -->
  <main class="flex-1 ml-20 md:ml-60 p-8">
    <div class="max-w-7xl mx-auto">
        <!-- User Welcome -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold mb-2">Welcome back, <span data-user-name>User</span></h1>
            <p class="text-[var(--text-muted)]">Here's your sports dashboard for today</p>
        </div>

        <!-- Team Snapshot Card -->
        <div class="dashboard-card p-8 mb-8 profile-header">
            <div class="flex flex-col md:flex-row items-center justify-between gap-8">
                <div class="text-center md:text-left">
                    <h2 class="text-2xl font-bold mb-3">Live Match Updates</h2>
                    <div class="text-4xl font-bold mb-2" id="matchTitle">Manchester United vs Arsenal</div>
                    <div class="text-[var(--text-muted)] mb-4">Premier League ‚Ä¢ Old Trafford</div>
                    <div class="text-6xl font-bold mb-6 text-center md:text-left">2 - 1</div>
                    <div class="flex gap-3 justify-center md:justify-start">
                        <button id="watchLive" class="px-6 py-3 bg-gradient-to-r from-indigo-600 to-indigo-700 rounded-xl font-medium hover:opacity-90 transition-all flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                            </svg>
                            Watch Live
                        </button>
                        <button id="matchStats" class="px-6 py-3 bg-gray-700 rounded-xl font-medium hover:bg-gray-600">Match Stats</button>
                    </div>
                </div>
                <div class="flex-1 max-w-sm">
                    <div class="space-y-4">
                        <h3 class="font-medium mb-2">Key Events</h3>
                        <div class="p-4 rounded-lg bg-indigo-500/10 border border-indigo-500/10">
                            <div class="space-y-3">
                                <div class="flex items-center gap-2">
                                    <span class="text-green-400">‚öΩ</span>
                                    <div>
                                        <div class="font-medium">Marcus Rashford 23'</div>
                                        <div class="text-xs text-[var(--text-muted)]">Assisted by Bruno Fernandes</div>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-yellow-400">üü®</span>
                                    <div>
                                        <div class="font-medium">Martin √òdegaard 35'</div>
                                        <div class="text-xs text-[var(--text-muted)]">Tactical Foul</div>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-400">‚öΩ</span>
                                    <div>
                                        <div class="font-medium">Bukayo Saka 41'</div>
                                        <div class="text-xs text-[var(--text-muted)]">Penalty</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-sm text-[var(--text-muted)]">
                            <span id="possession">Possession: MUN 54% ‚Ä¢ ARS 46%</span>
                            <span id="shots">Shots: 12 ‚Ä¢ 9</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sports Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="dashboard-card p-6">
                <h3 class="font-medium mb-4">Upcoming Matches</h3>
                <div class="space-y-3">
                    <div class="flex items-center gap-3">
                        <div class="w-2 h-2 rounded-full bg-green-400"></div>
                        <span>Chelsea vs Liverpool ‚Ä¢ 8:30 PM</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-2 h-2 rounded-full bg-blue-400"></div>
                        <span>Real Madrid vs Barcelona ‚Ä¢ Tomorrow</span>
                    </div>
                </div>
            </div>
            <div class="dashboard-card p-6">
                <h3 class="font-medium mb-4">Top Scorer</h3>
                <div class="text-2xl font-bold mb-2">Erling Haaland</div>
                <p class="text-sm text-[var(--text-muted)]">18 goals ‚Ä¢ 4 assists</p>
                <div class="w-full bg-gray-800 rounded-full h-2 mt-3">
                    <div class="bg-indigo-500 h-2 rounded-full" style="width: 85%"></div>
                </div>
            </div>
            <div class="dashboard-card p-6">
                <h3 class="font-medium mb-4">League Position</h3>
                <div class="text-2xl font-bold mb-2">3rd</div>
                <div class="flex items-center gap-2">
                    <span class="text-green-400">‚Üë</span>
                    <p class="text-sm text-[var(--text-muted)]">2 positions this week</p>
                </div>
            </div>
        </div>

        <!-- Today's Schedule -->
        <div class="dashboard-card p-6">
            <h3 class="font-medium mb-6">Today's Schedule</h3>
            <div class="space-y-4" id="scheduleList">
                <div class="flex gap-4 items-start">
                    <div class="text-sm text-[var(--text-muted)] w-20">09:00 AM</div>
                    <div class="flex-1 p-4 rounded-lg bg-indigo-500/10 border border-indigo-500/20">
                        <div class="font-medium">Sports Session</div>
                        <div class="text-sm text-[var(--text-muted)]">Cricket Match</div>
                    </div>
                </div>
                <!-- More schedule items -->
            </div>
        </div>

        <!-- Add these premium features after your existing dashboard header -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="col-span-2 premium-card dashboard-card p-6">
                <div class="flex items-center gap-4 mb-6">
                    <div class="w-12 h-12 rounded-xl bg-indigo-500/10 flex items-center justify-center">
                        <svg class="w-6 h-6 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold">Smart Insights</h3>
                        <p class="text-[var(--text-muted)]">AI-powered analysis of your habits</p>
                    </div>
                </div>
                <div id="smartInsights" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Insights will be populated here -->
                </div>
            </div>

            <div class="dashboard-card p-6">
                <div class="productivity-ring mb-6">
                    <canvas id="productivityChart" width="200" height="200"></canvas>
                    <div class="absolute inset-0 flex items-center justify-center flex-col">
                        <div class="text-3xl font-bold" id="productivityScore">92</div>
                        <div class="text-sm text-[var(--text-muted)]">Total Matches</div>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-[var(--text-muted)]">Watch Time</span>
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-medium">4.5h</span>
                            <span class="text-xs text-green-400">‚Üë12%</span> 
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-[var(--text-muted)]">Matches Done</span>
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-medium">15/18</span>
                            <span class="text-xs text-green-400">‚Üë8%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions Grid -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <button class="dashboard-card p-4 flex items-center gap-3 hover:scale-[1.02] transition-transform">
                <div class="w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-500">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                </div>
                <span>Quick Task</span>
            </button>
            <!-- Add more quick actions -->
        </div>

        <!-- Premium Features Banner -->
        <div class="dashboard-card p-6 bg-gradient-to-r from-indigo-500/20 to-purple-500/20 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-xl font-bold mb-2">Premium Features Unlocked</h3>
                    <p class="text-[var(--text-muted)]">Enjoy advanced analytics and AI insights</p>
                </div>
                <div class="text-3xl">‚ú®</div>
            </div>
        </div>

    </div>
  </main>

  <script type="module">
    import { TaskManager } from './js/taskManager.js';
    import { DashboardManager } from './js/dashboard.js';
    import { updateUserDisplay } from './js/userInfo.js';
    import { InsightsEngine } from './js/insights.js';

    let timeLeft = 25 * 60;
    let timerInterval;
    let isRunning = false;

    function updateTimer() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        document.getElementById('focusTimer').textContent = 
            `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    // Task selection handler
    document.getElementById('focusTask').addEventListener('change', (e) => {
        const task = TaskManager.getTaskById(parseInt(e.target.value));
        if (task) {
            timeLeft = task.duration * 60;
            updateTimer();
        }
    });

    // Start/Pause button handler
    document.getElementById('startFocus').addEventListener('click', () => {
        const taskSelect = document.getElementById('focusTask');
        if (!taskSelect.value) {
            alert('Please select a task first!');
            return;
        }

        if (isRunning) {
            clearInterval(timerInterval);
            document.getElementById('startFocus').innerHTML = `

                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                </svg>
                Resume
            `;
            isRunning = false;
        } else {
            document.getElementById('startFocus').innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M10 9v6m4-6v6m-7-3h14"/>
                </svg>
                Pause
            `;
            isRunning = true;
            timerInterval = setInterval(() => {
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    isRunning = false;
                    document.getElementById('startFocus').innerHTML = `
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                        </svg>
                        Start Focus
                    `;
                    new Audio('./assets/sounds/complete.mp3')?.play();
                    alert('Time is up!');
                    return;
                }
                timeLeft--;
                updateTimer();
            }, 1000);
        }
    });

    // Reset button handler
    document.getElementById('resetTimer').addEventListener('click', () => {
        clearInterval(timerInterval);
        const selectedTask = TaskManager.getTaskById(parseInt(document.getElementById('focusTask').value));
        timeLeft = selectedTask ? selectedTask.duration * 60 : 25 * 60;
        updateTimer();
        isRunning = false;
        document.getElementById('startFocus').innerHTML = `
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
            </svg>
            Start Focus
        `;
    });

    function updateDashboard() {
        const tasks = TaskManager.getActiveTasks();
        
        // Update priority tasks
        const priorityList = document.querySelector('.space-y-3');
        if (priorityList && tasks.length > 0) {
            priorityList.innerHTML = tasks.slice(0, 2).map(task => `
                <div class="flex items-center gap-3">
                    <div class="w-2 h-2 rounded-full ${task.priority === 'high' ? 'bg-red-400' : 'bg-yellow-400'}"></div>
                    <span>${task.title}</span>
                </div>
            `).join('');
        } else if (priorityList) {
            priorityList.innerHTML = '<div class="text-[var(--text-muted)]">No tasks for today</div>';
        }

        // Update schedule
        const scheduleList = document.getElementById('scheduleList');
        if (scheduleList) {
            const todaysTasks = TaskManager.getTasks().filter(t => !t.completed);
            scheduleList.innerHTML = todaysTasks.length > 0 ? 
                todaysTasks.map(task => `
                    <div class="flex gap-4 items-start">
                        <div class="text-sm text-[var(--text-muted)] w-20">${task.duration} min</div>
                        <div class="flex-1 p-4 rounded-lg bg-indigo-500/10 border border-indigo-500/20">
                            <div class="font-medium">${task.title}</div>
                            <div class="text-sm text-[var(--text-muted)]">${task.description || ''}</div>
                        </div>
                    </div>
                `).join('') : 
                '<div class="text-[var(--text-muted)] text-center">No tasks scheduled</div>';
        }
    }

    async function updateSmartInsights() {
        const container = document.getElementById('smartInsights');
        
        // Get insights from all sources
        const [productivityInsights, sleepInsights, moodInsights] = await Promise.all([
            InsightsEngine.getProductivityInsights(),
            InsightsEngine.getSleepOptimizationInsights(),
            InsightsEngine.getMoodInsights()
        ]);
        
        // Combine and sort by priority
        const allInsights = [...productivityInsights, ...sleepInsights, ...moodInsights]
            .sort((a, b) => a.priority === 'high' ? -1 : 1);
        
        // Display insights
        container.innerHTML = allInsights.map(insight => `
            <div class="insight-card relative overflow-hidden rounded-xl p-6" 
                style="background: linear-gradient(135deg, rgba(76,111,255,0.1), rgba(138,92,255,0.1));">
                <div class="flex items-center gap-3 mb-3">
                    <div class="text-2xl">${insight.icon}</div>
                    <div class="font-medium">${insight.title}</div>
                </div>
                <p class="text-[var(--text-muted)] mb-4">${insight.text}</p>
                <div class="flex items-center gap-2 text-sm">
                    <span class="px-2 py-1 rounded bg-indigo-500/20 text-indigo-300">
                        ${insight.action}
                    </span>
                    ${insight.priority === 'high' ? '<span class="text-red-400">‚óè</span>' : ''}
                </div>
                <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-500/5 to-purple-500/5 rounded-full transform translate-x-16 translate-y--16"></div>
            </div>
        `).join('');
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        updateUserDisplay();
        DashboardManager.initialize();
        updateDashboard();
        updateTimer();
        updateSmartInsights();
    });

    // Listen for updates
    window.addEventListener('tasksUpdated', () => {
        updateDashboard();
        DashboardManager.updateTaskSelect();
        updateSmartInsights();
    });

    window.addEventListener('storage', updateSmartInsights);
</script>

<!-- Add this script before closing body -->
<script>
    // Initialize Charts
    function initializeCharts() {
        // Focus Chart
        new Chart(document.getElementById('focusChart'), {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Focus Score',
                    data: [75, 82, 68, 90, 85, 75, 88],
                    borderColor: getComputedStyle(document.documentElement).getPropertyValue('--accent'),
                    tension: 0.4,
                    fill: true,
                    backgroundColor: 'rgba(138, 92, 246, 0.1)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    }
                }
            }
        });

        // Sleep Chart
        new Chart(document.getElementById('sleepChart'), {
            type: 'bar',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Hours Slept',
                    data: [7.5, 8, 6.5, 7, 8.5, 9, 8],
                    backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--secondary'),
                    borderRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 12,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    }
                }
            }
        });

        // Mood Chart
        new Chart(document.getElementById('moodChart'), {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Mood Score',
                    data: [85, 75, 82, 90, 88, 95, 92],
                    borderColor: getComputedStyle(document.documentElement).getPropertyValue('--accent'),
                    tension: 0.4,
                    fill: true,
                    backgroundColor: 'rgba(138, 92, 246, 0.1)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    }
                }
            }
        });
    }

    // Modal Functions
    function openStatsModal(type) {
        const modal = document.getElementById('statsModal');
        const title = document.getElementById('statsModalTitle');
        const content = document.getElementById('statsModalContent');

        title.textContent = type.charAt(0).toUpperCase() + type.slice(1) + ' Statistics';
        
        // Add detailed stats based on type
        content.innerHTML = `
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <canvas id="detailed${type}Chart" height="300"></canvas>
                <div class="space-y-4">
                    <div class="p-4 rounded-xl bg-white/5">
                        <h4 class="font-medium mb-2">Weekly Average</h4>
                        <p class="text-2xl font-bold text-[var(--accent)]">85%</p>
                    </div>
                    <div class="p-4 rounded-xl bg-white/5">
                        <h4 class="font-medium mb-2">Monthly Progress</h4>
                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full w-[75%] bg-gradient-to-r from-[var(--secondary)] to-[var(--accent)]"></div>
                        </div>
                    </div>
                    <div class="p-4 rounded-xl bg-white/5">
                        <h4 class="font-medium mb-2">Insights</h4>
                        <p class="text-sm text-[var(--text-muted)]">Your ${type} patterns show improvement compared to last week. Keep up the good work!</p>
                    </div>
                </div>
            </div>
        `;

        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }

    function closeStatsModal() {
        const modal = document.getElementById('statsModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }

    function openNewPostModal() {
        const modal = document.getElementById('newPostModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }

    function closeNewPostModal() {
        const modal = document.getElementById('newPostModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }

    function submitPost(event) {
        event.preventDefault();
        const content = event.target.querySelector('textarea').value;
        addMoodPost({
            user: 'You',
            content,
            timestamp: new Date(),
            reactions: { hearts: 0, hugs: 0, stars: 0 }
        });
        closeNewPostModal();
        event.target.reset();
    }

    function addMoodPost(post) {
        const postsContainer = document.getElementById('moodPosts');
        const postElement = document.createElement('div');
        postElement.className = 'mood-post';
        postElement.innerHTML = `
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[var(--secondary)] to-[var(--accent)] flex items-center justify-center text-white font-bold">
                        ${post.user[0]}
                    </div>
                    <div>
                        <h4 class="font-medium">${post.user}</h4>
                        <p class="text-sm text-[var(--text-muted)]">${new Date(post.timestamp).toLocaleString()}</p>
                    </div>
                </div>
            </div>
            <p class="mb-6">${post.content}</p>
            <div class="flex gap-3">
                <button class="reaction-button" onclick="toggleReaction(this, 'hearts')">
                    ‚ù§Ô∏è ${post.reactions.hearts}
                </button>
                <button class="reaction-button" onclick="toggleReaction(this, 'hugs')">
                    ü§ó ${post.reactions.hugs}
                </button>
                <button class="reaction-button" onclick="toggleReaction(this, 'stars')">
                    ‚≠ê ${post.reactions.stars}
                </button>
            </div>
        `;
        postsContainer.prepend(postElement);
    }

    function toggleReaction(button, type) {
        button.classList.toggle('active');
        const count = parseInt(button.textContent.match(/\d+/)[0]);
        button.textContent = button.textContent.replace(
            count,
            button.classList.contains('active') ? count + 1 : count - 1
        );
    }

    // Initialize everything when the page loads
    document.addEventListener('DOMContentLoaded', () => {
        // initialize particles like landing page for consistent animated background
        if (window.tsParticles) {
            try {
                tsParticles.load("particles", {
                  particles: {
                    number: { value: 50, density: { enable: true, value_area: 800 } },
                    color: { value: "#6366F1" },
                    opacity: { value: 0.2 },
                    size: { value: 3 },
                    move: { enable: true, speed: 1, direction: "none", random: true, out_mode: "out" }
                  }
                });
            } catch (e) {
                console.warn('tsParticles init failed', e);
            }
        }

        initializeCharts();

        // Add some sample mood posts
        [
            {
                user: 'Sarah',
                content: 'Grateful for the beautiful sunrise this morning. It reminded me to take a moment and appreciate the small things in life. üåÖ',
                timestamp: new Date(Date.now() - 1000 * 60 * 30),
                reactions: { hearts: 5, hugs: 3, stars: 7 }
            },
                {
                user: 'Michael',
                content: 'Finally completed my first week of consistent meditation. The peace it brings is incredible. Great job! üßò‚Äç‚ôÇÔ∏è',
                timestamp: new Date(Date.now() - 1000 * 60 * 60),
                reactions: { hearts: 8, hugs: 4, stars: 6 }
            }
        ].forEach(addMoodPost);
    });
</script>
</body>
</html>

